# アクスタ用ライト "SparkStage" ドキュメント・資料

フルカラーLEDを25個搭載した、アクリルスタンドフィギュアに好適なライトです。自動でイルミネーション動作するほか、WiFi経由で表示パターンや表示色を変更できます。

完成品に書き込んであるファームウェアは `sparkstage_firmware` にあります。


## 完成品の使い方

### 使い方：
USB Type-C電源に接続します（5V 1A以上出力できるもの）
起動すると、初期設定では自動でイルミネーション動作をします。

### スマホからの設定変更：
電源に接続すると、"SparkStage-XXXXXX" というSSIDにパスワード "12345678" でWiFi接続できます。
（"XXXXXX"は6ケタの英数字のIDで、個体ごとに異なります。）
このSSIDに接続後、 ブラウザで http://192.168.4.1/ を開いてください。
表示パターンや表示色を変更すると、即座に反映されます。最後に"Save"を押して保存します。

### 既存の2.4GHz WiFiネットワークへの参加：
初回は設定変更が必要です。設定ページ下部のWiFi SSIDとPasswordに参加したいWiFiの情報を入力し、
"Connect"を押してください。
"OK"というダイアログが表示されたら、いったん電源を抜き、もう一度電源に接続しなおしてください。
次回以降の起動では、設定されたWiFiへの接続を10秒までトライします。
もし誤った情報を設定してしまった場合は、もう一度設定ページから入力しなおしてください。

PCとiOSでは、"sparkstage-XXXXXX.local"というURLで設定ページが開けます。
（"XXXXXX"はWiFi SSIDと同じ英数字ID）

Androidは機種・バージョンによってこのURLが開けない場合があります。
（".Local Finder"など、mDNS対応アプリを試してみてください。）

空の情報を登録すると、設定したWiFiの情報が削除されます。


## 開発者向け資料

### 回路の構成：
マイコンはM5Stack社のM5StampS3です。
GPIO 1がNeoPixel制御データの送信ピンです。
NeoPixel "SK6812" が25個、マイコンからのデータピンには
3.3Vから5Vへのレベル変換回路が実装されています。
2つのGroveコネクタは、電源5V、信号レベル3.3Vでマイコンと
直結しています。
電源はM5StampS3のVUSBから取得していて、ここには1Aの
ポリスイッチが入っています。全点灯をするとポリスイッチが動作する
場合があるので、光量の調整をしてください。

### 基板・実装について：
M5StampS3を2.54mmヘッダーで取り付けてください。
Groveコネクタの実装は任意です。
基板形状は秋月電子 C基板と同じです。

### ファームウェアについて：
完成品に書き込んであるファームウェアは `sparkstage_firmware` にあります。
ArduinoではUSB DFU On Boot有効かつUSB-OTG有効の設定がおすすめです。（ケースに収めるとBOOTボタンを押すのが難しいため）

### 回路図
![](https://github.com/user-attachments/assets/adbad11e-b79a-435e-bba0-6d0dfce88cea)
